<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script src="https://cdn.jsdelivr.net/npm/pace-js@latest/pace.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@latest/pace-theme-default.min.css">
<!-- Custom Theme JavaScript -->
<script src="/js/handlebars-v4.0.11.js"></script>

  <meta name="theme-color" content="#fafafa">
</head>
<body>
  <div class="container">
   <h3>Mantra Counter</h3>
  </div>
  <div class="container">
    <form class="row g-3" name="mantraCountFrm" id="mantraCountFrm">
      <div class="col-md-4">
        <label for="validationCustom01" class="form-label">Mantra</label>
        <input type="text" class="form-control" name="mantra" id="mantra" value="avalokitesvara" required>
        <div class="valid-feedback">
          Looks good!
        </div>
      </div>
      <div class="col-md-4">
        <label for="validationCustom02" class="form-label">Count</label>
        <input type="number" class="form-control" name="count" id="count" value="1" required>
        <div class="valid-feedback">
          Looks good!
        </div>
      </div>
     
      <div class="col-12">
        <button id="reportbtn" class="btn " type="button">Report</button> <button class="btn btn-primary" type="submit">Submit form</button>
      </div>
    </form>
    <script type="module">
      
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-app.js";
      import {getFirestore,collection,getDocs,addDoc,setDoc,doc, query, where} from 'https://www.gstatic.com/firebasejs/9.4.1/firebase-firestore.js';
      
      const firebaseConfig = {
        apiKey: "AIzaSyATTCCw-ma_76C0wiDDW76y5qw1BRBXGpw",
        authDomain: "mantracounter-cf06f.firebaseapp.com",
        databaseURL: "https://mantracounter-cf06f-default-rtdb.firebaseio.com",
        projectId: "mantracounter-cf06f",
        storageBucket: "mantracounter-cf06f.appspot.com",
        messagingSenderId: "1091727105153",
        appId: "1:1091727105153:web:8742b2bdefaf34a1430180"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      var totalCount = 0;
      async function addMantra(){
        try{
          const docRef =  await addDoc(collection(db, "mantras"), {
            name: $("#mantra").val(),
            count: $("#count").val()
          });
          ///console.log("Document written with ID: ", docRef.id);
                //let docRef = await setDoc(mantraRef, {name: $("#mantra").val(),count: $("#count").val()});
                
              } catch (e) {
                console.error("Error adding document: ", e);
              }
}

          async function getReport(){
            const mantrasRef = collection(db, "mantras");
            // Create a query against the collection.
            const q = query(mantrasRef, where("name", "==", $("#mantra").val()));
            //console.log(q);
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
              // doc.data() is never undefined for query doc snapshots
              //console.log(doc.id, " => ", doc.data());
              //console.log(doc.data().count);
              totalCount = totalCount + Math.floor(doc.data().count);
            });
            alert($("#mantra").val() + " malas:"+totalCount +" counted:"+totalCount*108);
          }

      $( document ).ready(function() {

          $("#reportbtn").click(function( event ) {
            //console.log("here ...");
            getReport();
          });

          $( "#mantraCountFrm" ).submit(function( event ) {
              addMantra();
              alert("mantra count increased");
              document.getElementById("mantraCountFrm").reset();
              event.preventDefault();
              return false;
          });

      });
   
      
      $( window ).on( "load", function() {
          //console.log( "window loaded" );
      });
      </script>
  </div>
  <div class="container">
    <h3>Report</h3>
    <ul>
      <li>list</li>
      <li>list</li>
    </ul>
   </div>
</body>
</html>
